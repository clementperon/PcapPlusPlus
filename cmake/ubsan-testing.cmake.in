set(CTEST_SOURCE_DIRECTORY  "@CMAKE_SOURCE_DIR@")
set(CTEST_BINARY_DIRECTORY  "@CMAKE_BINARY_DIR@")
set(CTEST_CMAKE_GENERATOR   "@CMAKE_GENERATOR@")
set(CTEST_BUILD_NAME        "@CMAKE_SYSTEM_NAME@-@CMAKE_SYSTEM_PROCESSOR@-UndefinedBehaviorSanitizer")
set(CTEST_SITE              "@SITE@")

set(MODEL Experimental)
if(${CTEST_SCRIPT_ARG} MATCHES Nightly)
  set(MODEL Nightly)
elseif(${CTEST_SCRIPT_ARG} MATCHES Continuous)
  set(MODEL Continuous)
endif()

set(CTEST_MEMORYCHECK_TYPE "UndefinedBehaviorSanitizer")
ctest_start(${MODEL})
file(WRITE "${CTEST_BINARY_DIRECTORY}/CMakeCache.txt" "-g -O1 -fsanitize=undefined -fno-omit-frame-pointer")
ctest_configure()
ctest_build()
ctest_memcheck()

set(CDASH_TOKEN "$ENV{CTEST_CDASH_AUTH_TOKEN}")
if (NOT "${CDASH_TOKEN}" STREQUAL "")
	ctest_submit(HTTPHEADER "Authorization: Bearer ${CDASH_TOKEN}")
else()
  message("No CDASH Token found!!! Will not upload the result")
endif()
